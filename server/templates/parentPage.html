<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title><%= slug %></title>
  <link rel="shortcut icon" href="https://media.npr.org/favicon.ico">
  <% if (typeof stylesheet == "string") { %>
  <style>
  <%= stylesheet %>
  </style>
  <% } else { %>
  <link rel="stylesheet" href="/style.css">
  <% } %>
</head>
<body class="preview-page <%= deployed ? "deployed" : "" %>">
  <header class="toolbar">
    <a class="back hide-deployed" aria-hidden="true" href="/">&laquo;</a>

    <h1 class="title"><%= slug %></h1>
    
    <select class="breakpoint">
      <option value="sidebar">Sidebar (180px)</option>
      <option value="mobile" selected>Mobile (360px)</option>
      <option value="desktop">Desktop (730px)</option>
      <option value="fluid">Fluid</option>
    </select>
    
    <% if (typeof sheet != "undefined") { %>
    <a target="_blank" class="edit-sheet button" href="https://docs.google.com/spreadsheets/d/<%= sheet %>/edit#gid=0">Sheet</a>
    <% } %>

    <a target="_blank" class="prod-link button hide-deployed"
      href="http://<%= config.s3.bucket %>/<%= config.s3.prefix %>/<%= slug %>/preview.html">
      Live
    </a>
    <span class="spacer hide-deployed"></span>
    
    <button class="refresh-sheet hide-deployed">Refresh sheet</button>
    <button class="deploy-graphic hide-deployed">Deploy</button>

  </header>

  <div class="preview-container" data-width="mobile">
    <div data-pym-loader data-child-src="./index.html" id="preview">Loading...</div>
  </div>
  
  <hr>

  <section class="metadata">

    <h2>Embed code</h2>
    <textarea
      class="embed-code copy-on-click"
      readonly="readonly"
      rows="4"
      cols="80"
      aria-label="Embed code"
    ><%=
`<p data-pym-loader data-child-src="https://apps.npr.org/dailygraphics/graphics/{{slug}}"id="responsive-embed-{{slug}}"> Loading... </p> <script type="text/javascript" src="https://pym.nprapps.org/npr-pym-loader.v2.min.js"></script>`
.replace(/\</g, "&lt;")
.replace(/\>/g, "&gt;")
.replace(/\{\{slug\}\}/g, slug) %></textarea>

    <% 
    if (typeof COPY != "undefined") { 
      var m = s => (COPY.metadata && COPY.metadata[s]) || `__${s.toUpperCase()}__`;
    %>
    <h2>Copyedit e-mail</h2>
    <textarea 
      class="copyedit-email copy-on-click"
      readonly="readonly"
      rows="<%= 16 + Object.keys(COPY.labels).length * 3 %>"
      aria-label="Copyedit e-mail"
    >
This graphic accompanies <%= m("author") %>'s story, running <%= m("time") %>, about <%= m("subject") %>.

Story URL (not yet published): http://www.npr.org/templates/story/story.php?storyId=<%= m("seamus_id") %>&live=1

Expected run date: <%= m("time") %>

Primary graphics contact: <%= typeof user == "undefined" ? "__GRAPHICS_CONTACT__" : user.displayName %>
Primary editorial contact: <%= m("editorial_contact") %>

---- GRAPHIC <%= slug %> ----

Spreadsheet URL: https://docs.google.com/spreadsheets/d/<%= sheet %>/edit#gid=0
Production URL: https://apps.npr.org/dailygraphics/graphics/<%= slug %>/#desktop
<% Object.keys(COPY.labels).forEach(key => __p += `\n${key}: ${COPY.labels[key]}\n`); %>
    </textarea>
    <% } %>

  </section>

  <div class="toast"></div>

  <% if (!deployed) { %>
  <script type="module" src="/parentPage.js"></script>
  <% } %>
  <script src="https://pym.nprapps.org/npr-pym-loader.v2.min.js"></script>
  <script>
// this is here so that it still works on deployed pages
var preview = document.querySelector(".preview-container");
var breakSelect = document.querySelector("select.breakpoint");

breakSelect.addEventListener("change", function() {
  var breakpoint = this.value;
  preview.setAttribute("data-width", breakpoint);
});
  </script>
</body>
</html>
